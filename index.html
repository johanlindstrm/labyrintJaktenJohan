<!DOCTYPE html>
<html>
<head>
<title>Labyrint Jakten Johan</title>
<style>
html, body {margin: 0; height: 100%; overflow: hidden} /* Mainly not allowing scrolling on the page */
html{width: 700px;}
h1{ color: white; font-family: silkscreen; font-weight: normal; text-align: center; font-size: 3.5em;}
body{ margin: 0; background: black; }
button{ width: 100px; height: 45px; margin-left: 62px; font-family: silkscreen; font-size: 1.5em;  }
canvas{ margin-left: 60px;}
#mainmenu{ border: 3px solid white; position: absolute; }
</style>
</head>
<body onload="startGame()">
<h1>Labyrint Jakten</h1>
<canvas id="mainmenu" width="600" height="600" onclick="startGame()"></canvas>
<canvas id="game" width="600" height="600"></canvas>
<button type="button">UP</button>
<button type="button">LEFT</button>
<button type="button">RIGHT</button>
<button type="button">DOWN</button>
<p style="color: white; text-align: center; font-size: 30px;">USE ARROW KEYS TO MOVE</p>
</body>
</html>

<!--<script src="map.js" type="text/javascript"></script> -->
<script src="menu.js"></script>
<script src="Movement.js" type="text/javascript"></script>
<script type="text/javascript">

/**********
 * TODO
 * ADD Enemies ?
 * END GAME Function YES
 * START SPLASH SCREEN?
 * Documentera koden bättre GÖR DET NU SEN POKEMON!!!!!!!!!!!!!!!!
 * OG map 10x10
 * 
 * 
 * 
 * 
 *  */

// Get the canvas drawing context

var gameMap = [
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0,
	0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0,
	0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0,
	0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0,
	0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0,
	0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0,
	0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0,
	0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0,
	0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0,
	0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0,
	0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0,
	0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0,
	0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2, 0, //208 = 2 endtile make it end the game
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
];
// tileW 40 tileH 40
var tileW = 40, tileH = 40;
// mapW 10 mapH 10
var mapW = 15, mapH = 15;
var lastFrameTime = 0;

var tileEvents = {
	208 : endGame,
	22	: enemyCollide
};
// Function that is called when player lands on array space 208
function endGame()
{
	alert('Congratulations! YOU WIN!');
	console.log('GG');
	location.reload();
}
function enemyCollide()
{
	alert('Ugh! You died! Press OK to restart!');
	console.log('GG');
	location.reload();
}

// Making it easier to understand what the numbers and colors in the array means
var floorTypes = {
	solid	: 0,
	path	: 1,
	goal	: 1
	//enemy	: 1
}

var tileTypes = {
	0 : { colour:"#222648", floor:floorTypes.solid	},
	1 : { colour:"#808080", floor:floorTypes.path	},
	2 : { colour:"#00ff00", floor:floorTypes.goal	},
	//3 : { colour:"#000000", floor:floorTypes.enemy	},
}

var enemy = new enemy();
var player = new Character();

// Tag all keys as false from the beginning
var keysDown = 
{
	37 : false,
	38 : false,
	39 : false,
	40 : false
};
// Giving the enemy some properties (same as our player)
function enemy() {
	this.tileFrom	= [1,1];
	this.tileTo		= [1,1];
	this.timeMoved	= 0;
	this.dimensions	= [30,30];
	this.position	= [285,45]; // Starting position // use move the enemy?
	this.endPosition = [100,45];
	this.delayMove	= 300;
	
}

Character.prototype.canMoveTo = function(x, y)
{
	if(x < 0 || x >= mapW || y < 0 || y >= mapH) { return false; }
	if(tileTypes[gameMap[toIndex(x,y)]].floor!=floorTypes.path){ return false; }
	return true;
};

Character.prototype.canMoveUp		= function() { return this.canMoveTo(this.tileFrom[0], this.tileFrom[1]-1); };
Character.prototype.canMoveDown 	= function() { return this.canMoveTo(this.tileFrom[0], this.tileFrom[1]+1); };
Character.prototype.canMoveLeft 	= function() { return this.canMoveTo(this.tileFrom[0]-1, this.tileFrom[1]); };
Character.prototype.canMoveRight 	= function() { return this.canMoveTo(this.tileFrom[0]+1, this.tileFrom[1]); };

Character.prototype.moveLeft	= function(t) { this.tileTo[0]-=1; this.timeMoved = t; };
Character.prototype.moveRight	= function(t) { this.tileTo[0]+=1; this.timeMoved = t; };
Character.prototype.moveUp		= function(t) { this.tileTo[1]-=1; this.timeMoved = t; };
Character.prototype.moveDown	= function(t) { this.tileTo[1]+=1; this.timeMoved = t; };


function startGame()
{
	//ctx.clearRect(0, 0, canvas.width, canvas.height);

	ctx = document.getElementById('game').getContext("2d");
	requestAnimationFrame(Draw);

	window.addEventListener("keydown", function(e) {
		if(e.keyCode>=37 && e.keyCode<=40) { keysDown[e.keyCode] = true; }
	});
	window.addEventListener("keyup", function(e) {
		if(e.keyCode>=37 && e.keyCode<=40) { keysDown[e.keyCode] = false; }
	});
	Draw();
};

function erase() {
  context.fillStyle = '#FFFFFF';
  context.fillRect(0, 0, 600, 600);
}

function Draw()
{
	var currentFrameTime = Date.now();
	var timeElapsed = currentFrameTime - lastFrameTime;

	if(!player.processMovement(currentFrameTime))
		{if(keysDown[38] && player.canMoveUp())			{ player.moveUp(currentFrameTime); }
		else if(keysDown[40] && player.canMoveDown())	{ player.moveDown(currentFrameTime); }
		else if(keysDown[37] && player.canMoveLeft())	{ player.moveLeft(currentFrameTime); }
		else if(keysDown[39] && player.canMoveRight())	{ player.moveRight(currentFrameTime); }
    }

	for(var y = 0; y < mapH; ++y)
	{
		for(var x = 0; x < mapW; ++x)
		{
			ctx.fillStyle = tileTypes[gameMap[toIndex(x,y)]].colour; // Fills the tileTypes in the array

			ctx.fillRect( x*tileW, y*tileH, tileW, tileH);
		}
	}
	// Draws the player with the dimensions given
	ctx.fillStyle = "#00ffff";
	ctx.fillRect(player.position[0], player.position[1],
		player.dimensions[0], player.dimensions[1]);
		
	ctx.fillStyle = "#ff0000";
	ctx.fillRect(enemy.position[0], enemy.position[1],
    enemy.dimensions[0], enemy.dimensions[1]);
	
	lastFrameTime = currentFrameTime;
	requestAnimationFrame(Draw);
	 	//Create an end
}

console.log(gameMap);
// TODO 11/11
// Listen for keyup/keydown events YES
// Show the start menu nope
// startGame function, countdown, draw, NAH0
// endGame function
// Erase function
// Draw function, move player, timer, collider(canMove), draw player YEEEEES
</script>
